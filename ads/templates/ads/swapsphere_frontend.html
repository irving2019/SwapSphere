<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwapSphere - –û–±–º–µ–Ω –≤–µ—â–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-section h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .ads-section h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-bar input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }

        .ads-grid {
            display: grid;
            gap: 20px;
        }

        .ad-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-left: 4px solid #667eea;
        }

        .ad-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .ad-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .ad-description {
            color: #4a5568;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .ad-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #718096;
        }

        .ad-category {
            background: #e6fffa;
            color: #234e52;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 500;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #4a5568;
            font-size: 1.1rem;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #c53030;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #22543d;
        }

        .proposals-section {
            margin-top: 40px;
        }

        .proposal-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #48bb78;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .search-bar {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîÑ SwapSphere</h1>
            <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–±–º–µ–Ω–∞ –≤–µ—â–∞–º–∏</p>
        </div>

        <div class="main-content">
            <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
            <div class="card form-section">
                <h2>–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h2>
                <form id="adForm">
                    <div class="form-group">
                        <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                        <input type="text" id="title" name="title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="description" name="description" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à —Ç–æ–≤–∞—Ä, –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ —á—Ç–æ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –ø–æ–ª—É—á–∏—Ç—å –≤–∑–∞–º–µ–Ω"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="category" name="category">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            <option value="electronics">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                            <option value="books">–ö–Ω–∏–≥–∏</option>
                            <option value="clothing">–û–¥–µ–∂–¥–∞</option>
                            <option value="home">–î–æ–º –∏ –±—ã—Ç</option>
                            <option value="sports">–°–ø–æ—Ä—Ç</option>
                            <option value="other">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="condition">–°–æ—Å—Ç–æ—è–Ω–∏–µ</label>
                        <select id="condition" name="condition">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</option>
                            <option value="new">–ù–æ–≤–æ–µ</option>
                            <option value="like_new">–ö–∞–∫ –Ω–æ–≤–æ–µ</option>
                            <option value="good">–•–æ—Ä–æ—à–µ–µ</option>
                            <option value="fair">–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ</option>
                            <option value="poor">–ü–ª–æ—Ö–æ–µ</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
                </form>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π -->
            <div class="card ads-section">
                <h2>–û–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
                
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º...">
                    <button onclick="searchAds()" class="btn btn-secondary">–ù–∞–π—Ç–∏</button>
                    <button onclick="loadAds()" class="btn">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                
                <div id="adsContainer" class="ads-grid">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</div>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π -->
        <div class="card proposals-section">
            <h2>–ú–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞</h2>
            <div id="proposalsContainer">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π...</div>
            </div>
        </div>
    </div>

    <script>
        // –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
        const API_BASE = 'http://localhost:8000/api'; // –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL
        let currentAds = [];
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤
        async function apiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                showError(`–û—à–∏–±–∫–∞ API: ${error.message}`);
                return null;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.container').prepend(errorDiv);
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.querySelector('.container').prepend(successDiv);
            setTimeout(() => successDiv.remove(), 3000);
        }

        // –ü–µ—Ä–µ–≤–æ–¥ –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ —Ä—É—Å—Å–∫–∏–π
        const translations = {
            category: {
                'electronics': '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞',
                'books': '–ö–Ω–∏–≥–∏',
                'clothing': '–û–¥–µ–∂–¥–∞',
                'home': '–î–æ–º –∏ –±—ã—Ç',
                'sports': '–°–ø–æ—Ä—Ç',
                'other': '–î—Ä—É–≥–æ–µ'
            },
            condition: {
                'new': '–ù–æ–≤–æ–µ',
                'like_new': '–ö–∞–∫ –Ω–æ–≤–æ–µ',
                'good': '–•–æ—Ä–æ—à–µ–µ',
                'fair': '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ',
                'poor': '–ü–ª–æ—Ö–æ–µ'
            }
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        async function loadAds() {
            const container = document.getElementById('adsContainer');
            container.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</div>';
            
            const data = await apiRequest('/ads/');
            if (data) {
                currentAds = data.results || data;
                displayAds(currentAds);
            } else {
                container.innerHTML = '<div class="error">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Django —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:8000</div>';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        function displayAds(ads) {
            const container = document.getElementById('adsContainer');
            
            if (!ads || ads.length === 0) {
                container.innerHTML = '<div class="loading">–û–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            container.innerHTML = ads.map(ad => `
                <div class="ad-card">
                    <div class="ad-title">${ad.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                    <div class="ad-description">${ad.description || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                    <div class="ad-meta">
                        <span class="ad-category">${translations.category[ad.category] || ad.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}</span>
                        <span>–°–æ—Å—Ç–æ—è–Ω–∏–µ: ${translations.condition[ad.condition] || ad.condition || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</span>
                    </div>
                    <div style="margin-top: 15px;">
                        <button onclick="createProposal(${ad.id})" class="btn btn-secondary">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ–±–º–µ–Ω</button>
                    </div>
                </div>
            `).join('');
        }

        // –ü–æ–∏—Å–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        function searchAds() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (!searchTerm) {
                displayAds(currentAds);
                return;
            }

            const filtered = currentAds.filter(ad => 
                (ad.title && ad.title.toLowerCase().includes(searchTerm)) ||
                (ad.description && ad.description.toLowerCase().includes(searchTerm))
            );
            displayAds(filtered);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        document.getElementById('adForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const adData = {
                title: formData.get('title'),
                description: formData.get('description'),
                category: formData.get('category'),
                condition: formData.get('condition')
            };

            const result = await apiRequest('/ads/', {
                method: 'POST',
                body: JSON.stringify(adData)
            });

            if (result) {
                showSuccess('–û–±—ä—è–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!');
                e.target.reset();
                loadAds(); // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
            }
        });

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞
        async function createProposal(adId) {
            const proposalData = {
                ad: adId,
                message: '–•–æ—á—É –æ–±–º–µ–Ω—è—Ç—å—Å—è –Ω–∞ —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä'
            };

            const result = await apiRequest('/proposals/', {
                method: 'POST',
                body: JSON.stringify(proposalData)
            });

            if (result) {
                showSuccess('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–±–º–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
                loadProposals();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
        async function loadProposals() {
            const container = document.getElementById('proposalsContainer');
            container.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π...</div>';
            
            const data = await apiRequest('/proposals/');
            if (data) {
                const proposals = data.results || data;
                displayProposals(proposals);
            } else {
                container.innerHTML = '<div class="error">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</div>';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
        function displayProposals(proposals) {
            const container = document.getElementById('proposalsContainer');
            
            if (!proposals || proposals.length === 0) {
                container.innerHTML = '<div class="loading">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            container.innerHTML = proposals.map(proposal => `
                <div class="proposal-card">
                    <div><strong>–û–±—ä—è–≤–ª–µ–Ω–∏–µ:</strong> ${proposal.ad?.title || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                    <div><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${proposal.message || '–ë–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è'}</div>
                    <div><strong>–°—Ç–∞—Ç—É—Å:</strong> ${proposal.status || '–í –æ–∂–∏–¥–∞–Ω–∏–∏'}</div>
                    <div style="margin-top: 10px;">
                        ${proposal.status === 'pending' ? `
                            <button onclick="acceptProposal(${proposal.id})" class="btn btn-secondary">–ü—Ä–∏–Ω—è—Ç—å</button>
                            <button onclick="rejectProposal(${proposal.id})" class="btn" style="background: #e53e3e;">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // –ü—Ä–∏–Ω—è—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
        async function acceptProposal(proposalId) {
            const result = await apiRequest(`/proposals/${proposalId}/accept/`, {
                method: 'POST'
            });

            if (result) {
                showSuccess('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ!');
                loadProposals();
            }
        }

        // –û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
        async function rejectProposal(proposalId) {
            const result = await apiRequest(`/proposals/${proposalId}/reject/`, {
                method: 'POST'
            });

            if (result) {
                showSuccess('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ');
                loadProposals();
            }
        }

        // –ü–æ–∏—Å–∫ –ø–æ Enter
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchAds();
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            loadAds();
            loadProposals();
        });
    </script>
</body>
</html>